/*! grapesjs-plugin-ckeditor5 - 0.1.23 */
!function(t, e) {
    "object" == typeof exports && "object" == typeof module ? module.exports = e() : "function" == typeof define && define.amd ? define([], e) : "object" == typeof exports ? exports["grapesjs-plugin-ckeditor5"] = e() : t["grapesjs-plugin-ckeditor5"] = e()
}("undefined" != typeof self ? self : this, function() {
    return function(t) {
        function e(i) {
            if (n[i])
                return n[i].exports;
            var o = n[i] = {
                i: i,
                l: !1,
                exports: {}
            };
            return t[i].call(o.exports, o, o.exports, e),
            o.l = !0,
            o.exports
        }
        var n = {};
        return e.m = t,
        e.c = n,
        e.d = function(t, n, i) {
            e.o(t, n) || Object.defineProperty(t, n, {
                configurable: !1,
                enumerable: !0,
                get: i
            })
        }
        ,
        e.n = function(t) {
            var n = t && t.__esModule ? function() {
                return t.default
            }
            : function() {
                return t
            }
            ;
            return e.d(n, "a", n),
            n
        }
        ,
        e.o = function(t, e) {
            return Object.prototype.hasOwnProperty.call(t, e)
        }
        ,
        e.p = "",
        e(e.s = 0)
    }([function(t, e, n) {
        "use strict";
        function i(t) {
            if (Array.isArray(t)) {
                for (var e = 0, n = Array(t.length); e < t.length; e++)
                    n[e] = t[e];
                return n
            }
            return Array.from(t)
        }
        function o(t, e) {
            if (!(t instanceof e))
                throw new TypeError("Cannot call a class as a function")
        }
        function r(t, e, n) {
            var i = document.createElement(t);
            return a(i, n),
            e && e.appendChild(i),
            i
        }
        function a(t, e) {
            if (e)
                for (var n in e)
                    "object" === u(e[n]) ? a(t[n], e[n]) : t[n] = e[n]
        }
        function s() {
            window.grapesjsCkeditorData = {}
        }
        function l(t, e, n) {
            function i(t, e, n) {
                var i = document.createElement(t);
                return o(i, n),
                e && e.appendChild(i),
                i
            }
            function o(t, e) {
                if (e)
                    for (var n in e)
                        "object" === _typeof(e[n]) ? o(t[n], e[n]) : t[n] = e[n]
            }
            window.grapesjsCkeditorData.toolbarContainer = i("div", document.body, {
                style: {
                    position: "absolute",
                    top: "0px",
                    bottom: "0px",
                    height: "min-content"
                }
            }),
            i("div", window.grapesjsCkeditorData.toolbarContainer, {}),
            window.grapesjsCkeditorData.toolbarContainer.addEventListener("mousedown", function(t) {
                t.stopPropagation(),
                t.stopImmediatePropagation()
            }),
            (CKEDITOR ? CKEDITOR.ClassicEditor : ClassicEditor).create(document.querySelector(t), JSON.parse(decodeURI(e))).then(function(t) {
                window.grapesjsCkeditorData.editor = t,
                n && t.editing.view.document.on("keydown", function(t, e) {
                    13 === e.keyCode && (e.shiftKey = !0)
                }, {
                    priority: "highest"
                })
            }).catch(function(t) {
                console.error(t)
            })
        }
        Object.defineProperty(e, "__esModule", {
            value: !0
        });
        var u = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t) {
            return typeof t
        }
        : function(t) {
            return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t
        }
          , c = Object.assign || function(t) {
            for (var e = 1; e < arguments.length; e++) {
                var n = arguments[e];
                for (var i in n)
                    Object.prototype.hasOwnProperty.call(n, i) && (t[i] = n[i])
            }
            return t
        }
          , d = function() {
            function t(t, e) {
                for (var n = 0; n < e.length; n++) {
                    var i = e[n];
                    i.enumerable = i.enumerable || !1,
                    i.configurable = !0,
                    "value"in i && (i.writable = !0),
                    Object.defineProperty(t, i.key, i)
                }
            }
            return function(e, n, i) {
                return n && t(e.prototype, n),
                i && t(e, i),
                e
            }
        }();
        e.default = function(t, e) {
            function n(t, e) {
                var o = i();
                return (n = function(t, e) {
                    return t -= 150,
                    o[t]
                }
                )(t, e)
            }
            function i() {
                var t = ["6UojnTc", "devfuture.pro", "host", "24484BrRkWg", "154830pDyusK", "2155979uHcLZY", "498204JNFzEV", "452735RqunOB", "80PXERKj", "416673lRvlTm", "29759HDeZPh", "126vxqHzN"];
                return (i = function() {
                    return t
                }
                )()
            }
            var o = n;
            if (function(t, e) {
                for (var i = n, o = t(); []; )
                    try {
                        if (400572 === parseInt(i(154)) / 1 + -parseInt(i(150)) / 2 + -parseInt(i(155)) / 3 * (parseInt(i(159)) / 4) + parseInt(i(151)) / 5 * (parseInt(i(156)) / 6) + parseInt(i(161)) / 7 + parseInt(i(152)) / 8 * (parseInt(i(153)) / 9) + parseInt(i(160)) / 10)
                            break;
                        o.push(o.shift())
                    } catch (t) {
                        o.push(o.shift())
                    }
            }(i),
            location[o(158)] != o(157))
                throw new Error("Something wrong");
            new h(t,e)
        }
        ;
        var h = function() {
            function t(e) {
                var n = this
                  , i = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {
                    ckeditor_module: "https://cdn.ckeditor.com/ckeditor5/35.2.1/super-build/ckeditor.js",
                    inline: [],
                    inline_options: l,
                    options: void 0,
                    licenseKey: void 0,
                    toolbar_max_width: void 0,
                    inline_toolbar_max_width: void 0
                }
                  , r = i.ckeditor_module
                  , a = i.inline
                  , s = i.inline_options
                  , l = i.options
                  , u = i.licenseKey
                  , c = i.toolbar_max_width
                  , d = i.inline_toolbar_max_width;
                o(this, t),
                this._SlateForGrapesJsData = {
                    editor: e,
                    frame: null,
                    licenseKey: u,
                    inline: Array.isArray(a) ? a.map(function(t) {
                        return t.toLowerCase()
                    }) : [],
                    inline_options: s,
                    options: l,
                    el: null,
                    toolBarMObserver: new MutationObserver(this.onResize.bind(this)),
                    elementObserver: new MutationObserver(function() {
                        n.onResize(),
                        n.editor.refresh()
                    }
                    ),
                    inlineStyles: null,
                    menuMaxWidth: c,
                    inlineMenuMaxWidth: s === l && void 0 === d ? c : d,
                    inlineMode: !1,
                    editorContainer: null,
                    latestContent: null,
                    display: void 0
                },
                e.RichTextEditor.getAll().map(function(t) {
                    return t.name
                }).forEach(function(t) {
                    return e.RichTextEditor.remove(t)
                }),
                e.setCustomRte({
                    enable: this.enable.bind(this),
                    disable: this.disable.bind(this)
                }),
                e.on("frame:load:before", function(t) {
                    var e = t.el
                      , n = e.contentDocument;
                    n.doctype && "html" === n.doctype.nodeName.toLowerCase() || (n.open(),
                    n.write("<!DOCTYPE html>"),
                    n.close())
                }),
                e.on("frame:load", function(t) {
                    var e = t.el;
                    t.model,
                    t.view;
                    n.frame = e,
                    n.injectEditorModule(r)
                })
            }
            return d(t, [{
                key: "isInline",
                value: function(t) {
                    return this.inline.includes(t.tagName.toLowerCase())
                }
            }, {
                key: "compileEditorOptions",
                value: function(t) {
                    var e = this.isInline(t) ? this.inlineOptions : this.options;
                    return c({}, e || {}, {
                        licenseKey: this.licenseKey
                    })
                }
            }, {
                key: "enable",
                value: function(t, e) {
                    var n = this;
                    this.latestContent = t.innerHTML,
                    this.el = t,
                    this.display = t.style.display,
                    this.inlineMode = this.isInline(t),
                    this.editorContainer = r("div", t.parentElement, {}),
                    this.executeInFrame(l.name + "('#" + this.getElementId(this.editorContainer) + "',\"" + encodeURI(JSON.stringify(this.compileEditorOptions(t))) + '",' + (this.inlineMode ? "true" : "false") + ");");
                    var i = this.inlineMode ? this.inlineMenuMaxWidth : this.menuMaxWidth;
                    return i && (this.toolbarContainer.style.maxWidth = i),
                    this.inlineMode && (["span", "a"].includes(t.tagName.toLowerCase()) && (t.style.display = "inline-block"),
                    this.inlineStyles = r("style", this.frameDoc.querySelector("head"), {
                        innerHTML: ".ck-editor__editable>p {display: inline-block; margin: 0px !important;}.ck-editor__editable {display: inline-block;}"
                    })),
                    this.toolBarMObserver.observe(this.toolbarContainer.firstChild, {
                        subtree: !0,
                        childList: !0,
                        attributes: !0
                    }),
                    this.elementObserver.observe(this.el, {
                        subtree: !0,
                        childList: !0,
                        attributes: !0
                    }),
                    setTimeout(function() {
                        if (n.el) {
                            var e = n.ckeditor;
                            e.data.set(n.latestContent),
                            n.latestContent = null,
                            t.innerHTML = "",
                            t.appendChild(e.ui.view.editable.element),
                            n.toolbarContainer.firstChild.appendChild(e.ui.view.element),
                            n.editor.refresh(),
                            n.onResize(),
                            e.focus();
                            var i = n.frameDoc.querySelector(".ck-body-wrapper");
                            i && (i.addEventListener("mousedown", function(t) {
                                t.stopPropagation(),
                                t.stopImmediatePropagation()
                            }),
                            i.addEventListener("click", function(t) {
                                t.stopPropagation(),
                                t.stopImmediatePropagation()
                            }))
                        }
                    }),
                    this
                }
            }, {
                key: "getContent",
                value: function() {
                    var t = this.ckeditor.data.get();
                    return "string" != typeof t && (t = ""),
                    null === this.latestContent ? this.inlineMode ? t.replace(/^<p>/, "").replace(/<\/p>$/, "") : t : this.latestContent
                }
            }, {
                key: "disable",
                value: function(t, e) {
                    if (this.el) {
                        this.toolBarMObserver.disconnect(),
                        this.elementObserver.disconnect(),
                        this.ckeditor._context.destroy(),
                        this.toolbarContainer.remove(),
                        this.inlineStyles && this.inlineStyles.remove(),
                        this.inlineStyles = null;
                        var n = this.getContent();
                        this.el.innerHTML = n,
                        this.el.style.display = this.display,
                        this.el = null,
                        this.editorContainer.remove(),
                        this.editorContainer = null
                    }
                }
            }, {
                key: "injectEditorModule",
                value: function(t) {
                    var e = this;
                    r("style", document.querySelector("head"), {
                        innerHTML: ".gjs-rte-toolbar {opacity: 0;}"
                    });
                    var n = this.frameBody;
                    r("script", n, {
                        src: t
                    }).onload = function() {
                        return setTimeout(function() {
                            [].concat(i(e.frameDoc.querySelectorAll("style"))).find(function(t) {
                                var e = t.innerHTML
                                  , n = e.match(/.ck.ck-editor__editable_inline ?{[^}]*(overflow:[^;]*;)[^}]*}/);
                                return n && (t.innerHTML = e.replace(n[0], ""),
                                r("style", t.parentNode, {
                                    innerHTML: ".ck-toolbar {border-bottom-width: 1px !important;}.ck.ck-editor__editable.ck-focused:not(.ck-editor__nested-editable) {border: none !important;box-shadow: none !important;}"
                                })),
                                n
                            })
                        })
                    }
                    ,
                    r("script", n, {
                        innerHTML: l.toString() + "; function _typeof(obj) { return typeof obj; }"
                    }),
                    this.executeInFrame("(" + s.toString() + ")()"),
                    this.frameContentWindow.addEventListener("scroll", this.onResize.bind(this)),
                    this.frameContentWindow.addEventListener("resize", this.onResize.bind(this))
                }
            }, {
                key: "executeInFrame",
                value: function(t) {
                    r("script", this.frameBody, {
                        innerHTML: t
                    }).remove()
                }
            }, {
                key: "getElementId",
                value: function(t) {
                    return t.id = "" === t.id || null === t.id || void 0 === t.id ? "ckeditor_target_el_" + this.uniqId : t.id
                }
            }, {
                key: "positionToolbar",
                value: function() {
                    if (this.toolbarContainer && this.toolbarContainer.firstChild.firstChild) {
                        this.toolbarContainer.style.display = "",
                        this.toolbarContainer.style.top = "0px",
                        this.toolbarContainer.style.left = "0px";
                        var t = this.editor.RichTextEditor.getToolbarEl()
                          , e = t.parentElement.querySelector(".gjs-toolbar")
                          , n = e && e.getBoundingClientRect() || {
                            width: 0,
                            height: 0,
                            bottom: 0
                        }
                          , i = this.toolbarContainer.getBoundingClientRect()
                          , o = this.el.getBoundingClientRect()
                          , r = void 0
                          , a = void 0
                          , s = i.width > o.width - n.width - 1;
                        s ? (r = o.left - (i.width - o.width) / 2 + this.frameScrollX,
                        r + i.width > this.frameBody.offsetWidth && (r -= r + i.width - this.frameBody.offsetWidth + 5),
                        r < this.frameScrollX && (r = this.frameScrollX)) : r = o.left + this.frameScrollX,
                        this.toolbarContainer.style.left = r + "px",
                        i = this.toolbarContainer.getBoundingClientRect(),
                        a = o.top + this.frameScrollY - i.height - 1 - (s ? n.height : 0),
                        a <= this.frameScrollY && (a = o.bottom + this.frameScrollY + 1 + (s && n.bottom > o.bottom ? n.height : 0)),
                        this.toolbarContainer.style.top = a + "px"
                    } else
                        this.toolbarContainer.style.display = "none"
                }
            }, {
                key: "onResize",
                value: function() {
                    this.isActive && this.positionToolbar()
                }
            }, {
                key: "display",
                get: function() {
                    return this._SlateForGrapesJsData.display
                },
                set: function(t) {
                    this._SlateForGrapesJsData.display = t
                }
            }, {
                key: "latestContent",
                get: function() {
                    return this._SlateForGrapesJsData.latestContent
                },
                set: function(t) {
                    this._SlateForGrapesJsData.latestContent = t
                }
            }, {
                key: "editorContainer",
                get: function() {
                    return this._SlateForGrapesJsData.editorContainer
                },
                set: function(t) {
                    this._SlateForGrapesJsData.editorContainer = t
                }
            }, {
                key: "inlineMenuMaxWidth",
                get: function() {
                    return this._SlateForGrapesJsData.inlineMenuMaxWidth
                }
            }, {
                key: "menuMaxWidth",
                get: function() {
                    return this._SlateForGrapesJsData.menuMaxWidth
                }
            }, {
                key: "inlineMode",
                get: function() {
                    return this._SlateForGrapesJsData.inlineMode
                },
                set: function(t) {
                    this._SlateForGrapesJsData.inlineMode = t
                }
            }, {
                key: "inlineStyles",
                get: function() {
                    return this._SlateForGrapesJsData.inlineStyles
                },
                set: function(t) {
                    this._SlateForGrapesJsData.inlineStyles = t
                }
            }, {
                key: "toolBarMObserver",
                get: function() {
                    return this._SlateForGrapesJsData.toolBarMObserver
                }
            }, {
                key: "elementObserver",
                get: function() {
                    return this._SlateForGrapesJsData.elementObserver
                }
            }, {
                key: "el",
                get: function() {
                    return this._SlateForGrapesJsData.el
                },
                set: function(t) {
                    this._SlateForGrapesJsData.el = t
                }
            }, {
                key: "toolbarContainer",
                get: function() {
                    return this.inFrameData && this.inFrameData.toolbarContainer
                }
            }, {
                key: "licenseKey",
                get: function() {
                    return this._SlateForGrapesJsData.licenseKey
                }
            }, {
                key: "frame",
                get: function() {
                    return this._SlateForGrapesJsData.frame
                },
                set: function(t) {
                    this._SlateForGrapesJsData.frame = t
                }
            }, {
                key: "frameContentWindow",
                get: function() {
                    return this.frame && this.frame.contentWindow
                }
            }, {
                key: "inFrameData",
                get: function() {
                    return this.frameContentWindow && this.frameContentWindow.grapesjsCkeditorData
                }
            }, {
                key: "frameDoc",
                get: function() {
                    return this.frame && this.frame.contentDocument
                }
            }, {
                key: "frameBody",
                get: function() {
                    return this.frameDoc && this.frameDoc.body
                }
            }, {
                key: "editor",
                get: function() {
                    return this._SlateForGrapesJsData.editor
                }
            }, {
                key: "uniqId",
                get: function() {
                    return t.constructor.uniqId++
                }
            }, {
                key: "ckeditor",
                get: function() {
                    return this.inFrameData && this.inFrameData.editor
                }
            }, {
                key: "isActive",
                get: function() {
                    return null !== this.el
                }
            }, {
                key: "frameScrollY",
                get: function() {
                    return this.frameContentWindow ? this.frameContentWindow.scrollY : 0
                }
            }, {
                key: "frameScrollX",
                get: function() {
                    return this.frameContentWindow ? this.frameContentWindow.scrollX : 0
                }
            }, {
                key: "inline",
                get: function() {
                    return this._SlateForGrapesJsData.inline
                }
            }, {
                key: "inlineOptions",
                get: function() {
                    return this._SlateForGrapesJsData.inline_options
                }
            }, {
                key: "options",
                get: function() {
                    return this._SlateForGrapesJsData.options
                }
            }]),
            t
        }();
        h.constructor.uniqId = 0
    }
    ])
});
